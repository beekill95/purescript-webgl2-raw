#!/bin/bash

# pulp build -j 2
spago build

# pulp -t with --skip-entry-point and --no-check-main breaks on circleci for some reason...
# purs bundle +RTS -N2 -RTS --module=WebGL.Raw.Types --module=WebGL.Raw.Extensions.EXT.FragDepth --module=WebGL.Raw.Extensions.WEBGL.CompressedTextureEtc1 --module=WebGL.Raw.Extensions.EXT.DisjointTimerQueryWebgl2 --module=WebGL.Raw.Extensions.OES.TextureFloatLinear --module=WebGL.Raw.Extensions.WEBGL.DebugShaders --module=WebGL.Raw.Extensions.EXT.ShaderTextureLod --module=WebGL.Raw.Extensions.WEBGL.CompressedTexturePvrtc --module=WebGL.Raw.Extensions.OES.TextureHalfFloatLinear --module=WebGL.Raw.Extensions.OES.VertexArrayObject --module=WebGL.Raw.Extensions.OES.TextureHalfFloat --module=WebGL.Raw.Extensions.WEBGL.CompressedTextureS3tcSrgb --module=WebGL.Raw.Extensions.EXT.SRGB --module=WebGL.Raw.Extensions.WEBGL.CompressedTextureS3tc --module=WebGL.Raw.Extensions.OES.ElementIndexUint --module=WebGL.Raw.Extensions.WEBGL.ColorBufferFloat --module=WebGL.Raw.Extensions.WEBGL.DebugRendererInfo --module=WebGL.Raw.Extensions.EXT.TextureFilterAnisotropic --module=WebGL.Raw.Extensions.EXT.DisjointTimerQuery --module=WebGL.Raw.Extensions.OES.TextureFloat --module=WebGL.Raw.Extensions.OES.StandardDerivatives --module=WebGL.Raw.Extensions.WEBGL.DrawBuffers --module=WebGL.Raw.Extensions.WEBGL.LoseContext --module=WebGL.Raw.Extensions.WEBGL.DepthTexture --module=WebGL.Raw.Extensions.EXT.ColorBufferHalfFloat --module=WebGL.Raw.Extensions.EXT.ColorBufferFloat --module=WebGL.Raw.Extensions.WEBGL.CompressedTextureEtc --module=WebGL.Raw.Extensions.ANGLE.InstancedArrays --module=WebGL.Raw.Extensions.WEBGL.CompressedTextureAstc --module=WebGL.Raw.Extensions.EXT.BlendMinmax --module=WebGL.Raw.WebGL1.WebGLActiveInfo --module=WebGL.Raw.WebGL1.WebGLShaderPrecisionFormat --module=WebGL.Raw.WebGL1.Enums --module=WebGL.Raw.WebGL1.WebGLRenderingContext --module=WebGL.Raw.WebGL1.WebGLProgram --module=WebGL.Raw.WebGL1.WebGLBuffer --module=WebGL.Raw.WebGL1.WebGLFramebuffer --module=WebGL.Raw.WebGL1.WebGLRenderbuffer --module=WebGL.Raw.WebGL1.WebGLTexture --module=WebGL.Raw.WebGL1.WebGLShader --module=WebGL.Raw.WebGL1.VertexAttributes --module=WebGL.Raw.WebGL1.Uniforms --module=WebGL.Raw.WebGL1.WebGLContextEvent --module=WebGL.Raw.WebGL2.Enums --module=WebGL.Raw.WebGL2.WebGLBuffer --module=WebGL.Raw.WebGL2.WebGLFramebuffer --module=WebGL.Raw.WebGL2.WebGLRenderbuffer --module=WebGL.Raw.WebGL2.WebGLTexture --module=WebGL.Raw.WebGL2.WebGLProgram --module=WebGL.Raw.WebGL2.Uniforms --module=WebGL.Raw.WebGL2.VertexAttributes --module=WebGL.Raw.WebGL2.WebGL2RenderingContext --module=WebGL.Raw.WebGL2.WebGLQuery --module=WebGL.Raw.WebGL2.WebGLSampler --module=WebGL.Raw.WebGL2.WebGLSync --module=WebGL.Raw.WebGL2.WebGLTransformFeedback --module=WebGL.Raw.WebGL2.UniformBufferObjects --module=WebGL.Raw.WebGL2.WebGLVertexArrayObject 'output/*/*.js' > output/ps-all.js
spago bundle-module --main WebGL.Raw.WebGL1 -t output/gl.js
spago bundle-module --main WebGL.Raw.WebGL2 -t output/gl2.js
